<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>當選證明書確認與PDF匯出 (支援中文)</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 10px; background: #f9f9f9; }
  label { display: block; margin-top: 15px; }
  input, button { width: 100%; padding: 8px; margin-top: 5px; }
  button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
  button:hover { background-color: #45a049; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- 載入中文字型(使用 base64 編碼字型檔) -->
<script>
// 此為簡化示例，只示範字型載入部分，
// 請注意完整字型檔案很大，這裡用的是輕量範例字型 base64。

// Noto Sans CJK TC Regular 字型（精簡版） base64 字串，示意用
const fontBase64 = "AAEAAAASAQAABAAgR0RFRrRCsIIAA...（此處省略，實務請替換完整字型）";

window.onload = () => {
  const { jsPDF } = window.jspdf;

  // 將字型加載到 VFS
  jsPDF.API.addFileToVFS("NotoSansCJKtc-Regular.ttf", fontBase64);
  jsPDF.API.addFont("NotoSansCJKtc-Regular.ttf", "NotoSansCJKtc", "normal");
};
</script>

</head>
<body>
  <h2>當選證明書確認</h2>
  <form id="certForm">
    <label>姓名：
      <input type="text" name="name" required placeholder="請輸入您的姓名" />
    </label>
    <label>任期開始日期：
      <input type="date" name="term_start" value="2025-09-01" required />
    </label>
    <label>任期結束日期：
      <input type="date" name="term_end" value="2029-08-31" required />
    </label>
    <button type="submit">確認並匯出 PDF</button>
  </form>

  <script>
    document.getElementById('certForm').addEventListener('submit', function(event) {
      event.preventDefault();

      const { jsPDF } = window.jspdf;
      const formData = new FormData(this);
      const name = formData.get('name');
      const start = formData.get('term_start');
      const end = formData.get('term_end');

      const doc = new jsPDF();

      // 使用已載入的中文字型
      doc.setFont("NotoSansCJKtc");
      doc.setFontSize(22);
      doc.text('中央選舉委員會', 105, 30, { align: 'center' });
      doc.setFontSize(18);
      doc.text('當選證明書', 105, 45, { align: 'center' });

      doc.setFontSize(14);
      const lineHeight = 10;
      let y = 70;
      doc.text(`姓名：${name}`, 20, y);
      y += lineHeight * 2;

      const content = `經本屆市民代表選舉投票結果，確認您為當選人，\n特此頒發當選證明書。\n\n任期自 ${start} 起 至 ${end} 止。`;
      const splitText = doc.splitTextToSize(content, 170);
      doc.text(splitText, 20, y);

      y += splitText.length * lineHeight + 20;
      const dateStr = new Date().toISOString().split('T')[0];
      doc.text(`證明日期：${dateStr}`, 20, y);

      y += lineHeight * 3;
      doc.text('中央選舉委員會蓋章：', 20, y);
      doc.line(70, y + 2, 140, y + 2);  // 蓋章線

      doc.save(`${name}_當選證明書.pdf`);
    });
  </script>
</body>
</html>
